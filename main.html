<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>래프트(FROM GARBAGE)</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

        
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Gowun+Dodum&family=Hi+Melody&family=Jua&family=Poor+Story&family=Rubik:wght@300&display=swap');

        * {
            font-family: "Hi Melody", sans-serif;
            font-weight: 400;
            font-style: normal;
        }

    
    
        /* 제목 */
        .h1 {
            font-size: 4rem;
            margin: 1em;
            text-align: center;
        }

        /* 제목 */

        /* 시계 */
        .clock {

            width: 60%;
            margin: 0px auto;
            text-align: right;
            font-size: 3em;
            color: #333;
        }

        /* 시계 */

        /* 네비게이션바 */
        .nav {
            border-top: solid 1px #0077b6;
            border-bottom: solid 1px #0077b6;
            display: flex;
            justify-content: center;
            width: 60%;
            margin: 0 auto;
        }

        .nav_ul {
            text-align: center;
            display: flex;
        }

        .nav-ul li {
            font-size: 1.5rem;
            display: inline;
            text-align: center;
            flex-grow: 1;
            padding: 0 2rem;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.5s cubic-bezier(.25, .8, .25, 1);
        }

        .nav-ul p {
            font-size: 1rem;
            display: inline;
            text-align: center;
            flex-grow: 1;
            padding: 0 2rem;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.5s cubic-bezier(.25, .8, .25, 1);
        }

        .SMN_effect-14 {
            position: relative;
            transition: color 0.3s;
            cursor: pointer;
        }

        .SMN_effect-14:before {
            position: absolute;
            top: 100%;
            left: 50%;
            color: transparent;
            content: '•';
            text-shadow: 0 0 transparent;
            font-size: 13pt;
            transition: text-shadow 0.3s, color 0.3s;
            transform: translateX(-50%);
            pointer-events: none;
        }

        .SMN_effect-14:hover:before,
        .SMN_effect-14:focus:before {
            color: #000;
            text-shadow: 10px 0 #000, -10px 0 #000;
        }

        .SMN_effect-14:hover,
        .SMN_effect-14:focus {
            color: #0abde3;
        }

        /* 네비게이션바 */

        /* 팀소개 */
        .팀소개 {
            background-color: #90e0ef;
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            justify-content: space-between;
            width: 60%;
            padding: 1rem;
            margin: 5rem auto;
            border-radius: 10px;
            cursor: url("https://github.com/Lustella-123/Lustella-123/blob/main/claw-2027511_960_720.png?raw=true") 0 16, wait;
        }

        .raft {
            display: flex;
            width: 100%;
        }

        /* 팀소개 */

        /* 팀내용 */
        .팀내용 {
            display: flex;
            flex-direction: row;
            justify-content: space-evenly;
            width: 65%;
            margin: 5rem auto;
        }

        .팀카드 {
            background-color: #caf0f8;
            font-size: 1.1rem;
            width: 30%;
            padding: 1.5rem;
            height: auto;
            margin: 0;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .팀카드:hover {
            transform: translateY(-10px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .팀카드 h3 {
            font-size: 1.3rem;
            color: #0077b6;
            margin-bottom: 0.8rem;
        }

        .팀카드 ul {
            list-style-type: disc;
            padding-left: 1.2rem;
        }

        .팀카드 li {
            margin-bottom: 0.5rem;
            line-height: 1.6;
        }

        /* 팀내용 */

        /* 멤버내용 */
        .멤버 {
            display: flex;
            flex-direction: row;
            justify-content: space-evenly;
            width: 80%;
            margin: 0rem auto;
        }

        .멤버카드 {
            background-color: #ade8f4;
            font-size: 1rem;
            width: 20%;
            padding: 10px;
            height: auto;
            margin: 1rem;
        }

        .멤버카드 p {
            margin: 0;
        }

        .team {
            width: 1200px;

            margin: 20px auto 20px auto;
        }

        /* 멤버내용 */

        /* 방명록 */
        .guestbook {
            width: 1000px;
            background-color: #ade8f4;
            margin: 70px auto;
            border-radius: 15px;
            padding: 20px;
        }

        .guestbookcard {
            width: 1000px;
            border-radius: 15px;
            background-color: #ade8f4;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            padding: 20px;
            margin: 20px auto;
        }
        /* 방명록 */

        /* 날씨위젯 */
        #weather-widget {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 1rem;
            border: 1px solid #0077b6;
            background-color: #ffffff;
            border-radius: 5px;
            z-index: 1000;
        }
        /* 날씨위젯 */

    </style>
    <script type="module">
        // Firebase SDK 라이브러리 가져오기
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // Firebase 설정
        const firebaseConfig = {
            apiKey: "AIzaSyAtHlJLsyoZ4__m1-eXMaBBvpJNeJD74js",
            authDomain: "sprta-f3322.firebaseapp.com",
            projectId: "sprta-f3322",
            storageBucket: "sprta-f3322.firebasestorage.app",
            messagingSenderId: "56818984443",
            appId: "1:56818984443:web:fc1b3289fa5e6e969a575e",
            measurementId: "G-WZLQRD938T"
        };

        // Firebase 초기화
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // 방명록 저장 기능
        $(document).on("click", "#guestbookbtn", async function () {
            let name = $('#exampleFormControlInput1').val();
            let content = $('#exampleFormControlTextarea1').val();

            if (name && content) {
                let docData = {
                    'name': name,
                    'content': content
                };
                try {
                    await addDoc(collection(db, "guestbook"), docData);
                    alert('방명록이 저장되었습니다!');
                    window.location.reload();
                } catch (error) {
                    console.error("방명록 저장 중 오류가 발생했습니다: ", error);
                }
            } else {
                alert('이름과 내용을 모두 입력해주세요.');
            }
        });

        // 방명록 가져오기 및 카드로 표시
        async function loadGuestbook() {
            try {
                $('#card').empty();  // 기존 데이터를 초기화하여 중복 방지
                let docs = await getDocs(collection(db, "guestbook"));
                docs.forEach((doc) => {
                    let row = doc.data();
                    let id = doc.id;
                    let name = row['name'];
                    let content = row['content'];

                    let temp_html = `
                    <div class="guestbookcard" id="guestbook-${id}">
                        <div class="card-body">
                            <h3>${name}</h3>
                            <p>${content}</p>
                            <button type="button" class="btn btn-outline-primary edit-btn" data-id="${id}">수정</button>
                            <button type="button" class="btn btn-outline-danger delete-btn" data-id="${id}">삭제</button>
                        </div>
                    </div>`;

                    $('#card').append(temp_html);
                });
            } catch (error) {
                console.error("방명록을 가져오는 중 오류가 발생했습니다: ", error);
            }
        }

        // 페이지 로드 시 방명록 가져오기
        $(document).ready(function () {
            loadGuestbook();
        });

        // 방명록 삭제 기능
        $(document).on("click", ".delete-btn", async function () {
            let id = $(this).data("id");
            try {
                await deleteDoc(doc(db, "guestbook", id));
                alert('방명록이 삭제되었습니다.');
                $(`#guestbook-${id}`).remove();
            } catch (error) {
                console.error("방명록 삭제 중 오류가 발생했습니다: ", error);
            }
        });

        // 방명록 수정 기능
        $(document).on("click", ".edit-btn", async function () {
            let id = $(this).data("id");
            let docRef = doc(db, "guestbook", id);
            try {
                let docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    let row = docSnap.data();
                    let currentName = row['name'];
                    let currentContent = row['content'];
                    let newName = prompt("이름을 수정하세요:", currentName);
                    let newContent = prompt("내용을 수정하세요:", currentContent);
                    if (newName && newContent) {
                        await updateDoc(docRef, {
                            name: newName,
                            content: newContent
                        });
                        alert('방명록이 수정되었습니다.');
                        loadGuestbook();  // 수정 후 데이터 다시 로드하여 업데이트
                    }
                } else {
                    alert("문서를 찾을 수 없습니다.");
                }
            } catch (error) {
                console.error("방명록 수정 중 오류가 발생했습니다: ", error);
            }
        });

        // 시간 불러오는 기능
        function updateTime() {
            const timeElement = document.getElementById("time");
            const now = new Date(); // 현재 시간을 가져옵니다.

            // 시간을 형식에 맞게 가져오기
            const hours = String(now.getHours()).padStart(2, "0"); // 시
            const minutes = String(now.getMinutes()).padStart(2, "0"); // 분
            const seconds = String(now.getSeconds()).padStart(2, "0"); // 초

            // 시간을 문자열로 조합
            timeElement.textContent = `${hours}:${minutes}:${seconds}`;
        }

        // 1초마다 시간을 업데이트
        setInterval(updateTime, 1000);

        // 페이지가 로드될 때 즉시 시간을 표시하기 위해 초기 호출
        updateTime();

        // 일기예보
        function getCurrentDateTime() {
            const date = new Date();
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            let hours = date.getHours();
            const baseTimes = [2, 5, 8, 11, 14, 17, 20, 23];
            let baseTime = baseTimes.reduce((prev, curr) => (curr <= hours ? curr : prev));
            baseTime = String(baseTime).padStart(2, '0') + '00';
            if (hours < 2) {
                const prevDate = new Date(date.getTime() - 86400000); // 하루 전 날짜
                year = prevDate.getFullYear();
                month = String(prevDate.getMonth() + 1).padStart(2, '0');
                day = String(prevDate.getDate()).padStart(2, '0');
                baseTime = "2300";
            }
            return {
                date: `${year}${month}${day}`,
                time: baseTime
            };
        }
        async function fetchWeatherData(nx, ny) {
            const apiKey = 'YwQtuITGE24Cty%2BKIF1TkmtNgWiuGUKTCSB8cmqMKSDMRt8r8iq3wNheCCK5rUaTua8gArWcX4ZvS9dIq%2B%2FxiA%3D%3D'; // 본인의 서비스 키를 입력하세요.
            const {
                date: baseDate,
                time: baseTime
            } = getCurrentDateTime();
            const url = `http://apis.data.go.kr/1360000/VilageFcstInfoService_2.0/getVilageFcst?serviceKey=${apiKey}&numOfRows=10&pageNo=1&dataType=JSON&base_date=${baseDate}&base_time=${baseTime}&nx=${nx}&ny=${ny}`;
            try {
                const response = await fetch(url);
                const data = await response.json();

                if (data.response.header.resultCode === "00") {
                    displayForecast(data.response.body.items.item);
                } else {
                    console.error("API 응답 오류: ", data.response.header.resultMsg);
                }
            } catch (error) {
                console.error("날씨 데이터를 가져오는 중 오류 발생: ", error);
            }
        }
        function displayForecast(items) {
            const forecastContainer = document.getElementById("forecast");
            forecastContainer.innerHTML = "";
            items.forEach(item => {
                const category = item.category;
                const fcstValue = item.fcstValue;
                let displayText = "";
                if (category === "TMP") {
                    displayText = `기온 - ${fcstValue}℃`;
                } else if (category === "WSD") {
                    displayText = `풍속 - ${fcstValue}m/s`;
                } else if (category === "POP") {
                    displayText = `강수확률 - ${fcstValue}%`;
                }
                if (displayText) {
                    const forecastElement = document.createElement("p");
                    forecastElement.textContent = displayText;
                    forecastContainer.appendChild(forecastElement);
                }
            });
        }
        // if (navigator.geolocation) {
        //     navigator.geolocation.getCurrentPosition(position => {
        //         const {
        //             latitude,
        //             longitude
        //         } = position.coords;
        //         const nx = 60;
        //         const ny = 127;
        //         fetchWeatherData(nx, ny);
        //     }, error => {
        //         console.error("위치 정보를 가져오는 중 오류 발생: ", error);
        //     });
        // } else {
        //     console.log("사용자의 위치 정보를 가져올 수 없습니다.");
        // }
        if (localStorage.getItem('userPosition')) {
    const position = JSON.parse(localStorage.getItem('userPosition'));
    fetchWeatherData(position.nx, position.ny);
} else {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(position => {
            const { latitude, longitude } = position.coords;
            const nx = 60;  // 원하는 값으로 대체
            const ny = 127; // 원하는 값으로 대체
            localStorage.setItem('userPosition', JSON.stringify({ nx, ny }));
            fetchWeatherData(nx, ny);
        }, error => {
            console.error("위치 정보를 가져오는 중 오류 발생: ", error);
        });
    } else {
        console.log("사용자의 위치 정보를 가져올 수 없습니다.");
    }
}
        // 일기예보




        document.getElementById("teamIntro").addEventListener("click", function () {
            document.getElementById("팀소개").scrollIntoView({
                behavior: "smooth"
            });
        });

        document.getElementById("teamContent").addEventListener("click", function () {
            document.getElementById("팀내용").scrollIntoView({
                behavior: "smooth"
            });
        });

        document.getElementById("teamMembers").addEventListener("click", function () {
            document.getElementById("멤버").scrollIntoView({
                behavior: "smooth"
            });
        });

        // 방명록이 아직 없으므로 alert를 추가해놓음
        document.getElementById("guestbook").addEventListener("click", function () {
            document.getElementById("방명록").scrollIntoView({
                behavior: "smooth"
            });
        });

        document.getElementById("goLogin").addEventListener("click", function () {
            // 로그인 페이지로 이동하도록 설정
            window.location.href = "login.html";
        });
    </script>
</head>

<body>
    <!-- 제목 및 네비게이션바 -->
    <h1 class="h1">래프트(from garbage)</h1>

    <div class="clock">
        <h4 id="time"></h4>
    </div>

    <nav class="nav">
        <ul class="nav-ul">
            <li id="teamIntro" class="SMN_effect-14">팀 소개</li>
            <li id="teamContent" class="SMN_effect-14">팀 내용</li>
            <li id="teamMembers" class="SMN_effect-14">멤버</li>
            <li id="guestbook" class="SMN_effect-14">방명록</li>
            <li id="goLogin" class="SMN_effect-14">로그인하기</li>
        </ul>
    </nav>

    <!-- 일기예보 위젯 -->
    <div class="shadow p-3 mb-5 bg-body-tertiary rounded" id="weather-widget">
        <h4>단기예보</h4>
        <div id="forecast"></div>
    </div>

    <!-- 팀소개 -->
    <div class="팀소개" id="팀소개">
        <div>
            <h3>래프트(from garbage)</h3>
            <p>안녕하세요! 미니프로젝트에서 4조를 맡은 팀 래프트(from garbage)입니다.</p>
        </div>
        <div>
            <img class="raft"
                src="https://shared.cloudflare.steamstatic.com/store_item_assets/steam/apps/648800/header.jpg?t=1727184011"
                alt="Raft_steam">
        </div>
    </div>

    <!-- 팀내용 -->
    <div class="팀내용" id="팀내용">
        <div class="팀카드">
            <p>열심히 꾸며봐요!</p>
        </div>
        <div class="팀카드">
            <ul>
                <li>소통을 중요시하며 자리 비움이나 문제가 생기면 빠르게 공유하겠습니다.</li>
                <li>실수나 문제가 있어도 남 탓하지말고 문제를 해결해나가는데 집중하겠습니다.</li>
                <li>대화를 할 때는 캠도 켜고 화면공유도 잘 하겠습니다.</li>
                <li>파이팅하겠습니다!</li>
            </ul>
        </div>
        <div class="팀카드">
            <ul>
                <li>매일 일정 소화하기</li>
                <li>부끄러워도 물어보기</li>
                <li>이번 프로젝트 포트폴리오로 사용하기</li>
                <li>TIL 남은날까지 맨날 쓰기</li>
                <li>1일 1TIL, 1알고리즘</li>
            </ul>
        </div>
    </div>

    <!-- 멤버 -->
    <div class="team" id="멤버">
        <div class="row row-cols-1 row-cols-md-4 g-4">
            <div class="col">
                <a href="Card-HSW.html" class="card h-100 text-decoration-none">
                    <img src="https://img2.daumcdn.net/thumb/R658x0.q70/?fname=https://t1.daumcdn.net/news/202105/25/cineplay/20210525045427711lmfw.jpg"
                        class="card-img-top" alt="...">
                    <div class="card-body">
                        <h5 class="card-title">한성우</h5>
                        <p class="card-text">백앤드를 내 직업으로 공식적으로 발표하는 바이다</p>
                    </div>
                </a>
            </div>
            <div class="col">
                <a href="Main-PJS.html" class="card h-100 text-decoration-none">
                    <img src="https://pbs.twimg.com/profile_images/737671629895917568/GdPl88g0_400x400.jpg"
                        class="card-img-top" alt="...">
                    <div class="card-body">
                        <h5 class="card-title">박재성</h5>
                        <p class="card-text">그럼 시켜줘, 스프링 명예소방관</p>
                    </div>
                </a>
            </div>
            <div class="col">
                <a href="Main-BDH.html" class="card h-100 text-decoration-none">
                    <img src="https://pbs.twimg.com/media/Eo_xO_IVEAUXELV.jpg:large"
                        class="card-img-top" alt="...">
                    <div class="card-body">
                        <h5 class="card-title">방동혁</h5>
                        <p class="card-text">코드들은 수학 문제 같아.
                            조금만 더 연구하고 관찰하면 해답이 다 있거든</p>
                    </div>
                </a>
            </div>
            <div class="col">
                <a href="Main-LSC.html" class="card h-100 text-decoration-none">
                    <img src="https://img2.daumcdn.net/thumb/R658x0.q70/?fname=https://t1.daumcdn.net/news/202105/25/cineplay/20210525045437357svpj.jpg"
                        class="card-img-top" alt="...">
                    <div class="card-body">
                        <h5 class="card-title">이승찬</h5>
                        <p class="card-text">당신이... 코더 리..?<br>예아!</p>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <!-- 방명록 작성하기 -->
     <div class="guestbook" id="방명록">
        <h2>방명록 작성하기</h2>
        <div class="mb-3">
            <label for="exampleFormControlInput1" class="form-label">이름</label>
            <input type="text" class="form-control" id="exampleFormControlInput1" placeholder="이름">
        </div>
        <div class="mb-3">
            <label for="exampleFormControlTextarea1" class="form-label">방명록 내용 적기</label>
            <textarea class="form-control" id="exampleFormControlTextarea1" rows="3" placeholder="응원 한마디 적어주세요!!"></textarea>
        </div>
        <button type="button" class="btn btn-outline-dark" id="guestbookbtn">방명록 저장하기</button>
    </div>

    <!-- 방명록 카드 표시 -->
    <div id="card"></div>
</body>

</html>
